{"version":3,"sources":["LabelStudioEditor.tsx","index.tsx"],"names":["withStreamlitConnection","args","config","interfaces","user","task","LS_args","useMemo","ST_args","console","log","create_args","frameHeightCalc","componentFullHeight","frameHeight","updateFrameHeight","canvas","document","getElementsByClassName","length","Streamlit","setFrameHeight","client_height","clientHeight","useEffect","return_results","annotations","flag","status","results","serializeAnnotation","array","setComponentValue","LabelStudio","onLabelStudioLoad","LS","c","annotationStore","addAnnotation","userGenerate","selectAnnotation","id","onSubmitAnnotation","onUpdateAnnotation","onDeleteAnnotation","onSkipTask","style","height","width","overflow","ReactDOM","render","StrictMode","href","rel","getElementById"],"mappings":"uOAyMeA,mBAnKf,YAAoE,IAAvCC,EAAsC,EAAtCA,KAErBC,EAASD,EAAKC,OACdC,EAAaF,EAAKE,WAClBC,EAAOH,EAAKG,KACZC,EAAOJ,EAAKI,KAMZC,EAAUC,mBACd,kBAuIJ,SACEL,EACAC,EACAC,EACAC,GAEA,IAAMG,EAAU,CACdN,OAAQA,EACRC,WAAYA,EACZC,KAAMA,EACNC,KAAMA,GAGR,OADAI,QAAQC,IAAI,UAAWF,GAChBA,EApJOG,CAAYT,EAAQC,EAAYC,EAAMC,KAClD,CAACH,EAAQC,EAAYC,EAAMC,IAU7B,SAASO,EAAgBC,GACvB,IACIC,EAAcD,EADH,GAGf,OADAJ,QAAQC,IAAI,cAAeI,GACpBA,EAKT,SAASC,IAEP,IAAIC,EAASC,SAASC,uBACpB,aAKF,GAHAT,QAAQC,IAAI,UAAWM,GAGD,IAAlBA,EAAOG,OAAc,CACvBV,QAAQC,IAAI,QAIZU,IAAUC,eAAeT,EAFP,YAGb,GAAsB,IAAlBI,EAAOG,OAAc,CAC9BV,QAAQC,IAAI,YAEZ,IAAIY,EAAgBN,EAAO,GAAGO,aAE9BH,IAAUC,eAAeT,EAAgBU,KAuF7C,OA7GAb,QAAQC,IAAI,UAAWJ,GA6BvBkB,qBAAU,WAER,SAASC,EAEPC,GAOC,IAHDC,EAGA,uDAHe,EAEfC,EACA,uCACIC,EAAU,GACM,OAAhBH,IAEFG,EAAUH,EAAYI,uBAGxB,IAAIC,EAAQ,CAACF,EAASF,GAEtBP,IAAUY,kBAAkBD,GAC5BtB,QAAQC,IAAI,CAAEkB,UAAU,eAAgB,CAAEC,WAAW,OAAQ,CAAEF,SAO/C,IAAIM,IAAY,eAAgB,CAChD/B,OAAQI,EAAQJ,OAChBC,WAAYG,EAAQH,WACpBC,KAAME,EAAQF,KACdC,KAAMC,EAAQD,KAEd6B,kBAAmB,SAAUC,GAC3B1B,QAAQC,IAAI,OAAQyB,GAKpB,IAAIC,EAAID,EAAGE,gBAAgBC,cAAc,CACvCC,cAAc,IAEhBJ,EAAGE,gBAAgBG,iBAAiBJ,EAAEK,KAExCC,mBAAoB,SAAUP,EAAST,GACrCjB,QAAQC,IAAI,MAAO,CAAEyB,OAIrBV,EAAeC,EAHJ,EACE,mBAIfiB,mBAAoB,SAAUR,EAAST,GACrCjB,QAAQC,IAAI,aAAc,CAAEyB,OAI5BV,EAAeC,EAHJ,EACE,sBAIfkB,mBAAoB,SAAUT,EAAST,GACrCjB,QAAQC,IAAI,aAAc,CAAEyB,OAI5BV,EAAeC,EAHJ,EACE,sBAIfmB,WAAY,SAAUV,GACpB1B,QAAQC,IAAI,WAAY,CAAEyB,OAK1BV,EADkB,KAHP,EACE,gBAMjBV,OAGFA,IAGE,qBACE+B,MAAO,CAAEC,OAAQ,OAAQC,MAAO,OAAQC,SAAU,WAClDR,GAAG,oB,MC1JTS,IAASC,OACP,eAAC,IAAMC,WAAP,WACE,sBACEC,KAAK,iEACLC,IAAI,eAEN,qBAAKb,GAAG,eAAR,SACE,cAAC,EAAD,SAGJxB,SAASsC,eAAe,W","file":"static/js/main.50720232.chunk.js","sourcesContent":["/* \r\nLabel Studio (TM)\r\nCopyright (c) 2019-2021 Heartex, Inc. All Rights Reserved.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License. \r\n\r\nModifications Copyright (c) 2021 Selangor Human Resource Development Centre. All Rights Reserved.\r\n* 1. Adaptations to Streamlit Component API (https://docs.streamlit.io/en/stable/develop_streamlit_components.html)\r\n*/\r\n\r\nimport { ReactElement, useEffect, useMemo } from \"react\"\r\n\r\nimport {\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n  ComponentProps,\r\n} from \"streamlit-component-lib\"\r\n\r\nimport LabelStudio from \"label-studio\"\r\nimport \"label-studio/build/static/css/main.css\"\r\n\r\ninterface Args {\r\n  config: string\r\n  interfaces: string[]\r\n  user: Object\r\n  task: Object\r\n}\r\n\r\nfunction LabelStudioEditor({ args }: ComponentProps): ReactElement {\r\n  /* Streamlit Component Arguments */\r\n  const config = args.config\r\n  const interfaces = args.interfaces\r\n  const user = args.user\r\n  const task = args.task\r\n\r\n  /*\r\n  Load arguments into Args interface\r\n   * Args:config, interfaces, user, task\r\n   */\r\n  const LS_args = useMemo(\r\n    (): Args => create_args(config, interfaces, user, task),\r\n    [config, interfaces, user, task]\r\n  )\r\n\r\n  /* Function to dynamically calc frame height with 20px offset\r\n   *Args:\r\n   *componentFullHeight[int]: obtained from clientHeight of element\r\n   \r\n   Return:\r\n   *frameHeight[int]: frame height to be set with Streamlit.setFrameHeight()\r\n   */\r\n  function frameHeightCalc(componentFullHeight: number) {\r\n    const offset = 20\r\n    let frameHeight = componentFullHeight + offset\r\n    console.log(\"frameHeight\", frameHeight)\r\n    return frameHeight\r\n  }\r\n  console.log(\"useMemo\", LS_args)\r\n\r\n  /* Function to Update Frame Height */\r\n  function updateFrameHeight() {\r\n    /* Get DOM element for LS Editor <div> */\r\n    let canvas = document.getElementsByClassName(\r\n      \"ls-editor\"\r\n    )\r\n    console.log(\"Outside\", canvas)\r\n\r\n    /* Set initial render height in case <div> tag not found for className */\r\n    if (canvas.length === 0) {\r\n      console.log(\"NULL\")\r\n\r\n      let frameHeight = 1500\r\n\r\n      Streamlit.setFrameHeight(frameHeightCalc(frameHeight))\r\n    } else if (canvas.length !== 0) {\r\n      console.log(\"NOT NULL\")\r\n      /* Obtain clientHeight attribute from HTMLContainer  */\r\n      let client_height = canvas[0].clientHeight\r\n\r\n      Streamlit.setFrameHeight(frameHeightCalc(client_height))\r\n    }\r\n  }\r\n\r\n  /* useEffect Hook to render functions when there the component re-renders\r\n   * Does not include explicit dependencies to allow continuos render\r\n   */\r\n  useEffect(() => {\r\n    /* Function to RETURN ANNOTATION RESULTS back to Python Land */\r\n    function return_results(\r\n      /* annotation raw results from Label Studio */\r\n      annotations: any,\r\n      /* Used to indicate status of the annotation process\r\n       * 0(Load),1(Submit),2(Update),3(Delete),4(Skip)\r\n       */\r\n      flag: number = 1,\r\n      /* indicate labelling status `for logging purposes` */\r\n      status: string\r\n    ) {\r\n      let results = {}\r\n      if (annotations !== null) {\r\n        /* Generate serialised JSON of the annotation results */\r\n        results = annotations.serializeAnnotation()\r\n      }\r\n      /* Place 'results' and 'flag' into an array */\r\n      let array = [results, flag]\r\n      /* Return array back to Python Land */\r\n      Streamlit.setComponentValue(array)\r\n      console.log({ status }, \"Annotations:\", { results }, \"Flag\", { flag })\r\n    }\r\n\r\n    /*\r\n     *Instantiate Label Studio\r\n     */\r\n    // eslint-disable-next-line\r\n    var labelStudio = new LabelStudio(\"label-studio\", {\r\n      config: LS_args.config,\r\n      interfaces: LS_args.interfaces,\r\n      user: LS_args.user,\r\n      task: LS_args.task,\r\n\r\n      onLabelStudioLoad: function (LS: any) {\r\n        console.log(\"Load\", LS)\r\n        /* let flag = 0 // Skip Task Flag\r\n        let status = \"Load\"\r\n        const annotations = null //return nothing */\r\n        // return_results(annotations, flag, status)\r\n        var c = LS.annotationStore.addAnnotation({\r\n          userGenerate: true,\r\n        })\r\n        LS.annotationStore.selectAnnotation(c.id)\r\n      },\r\n      onSubmitAnnotation: function (LS: any, annotations: any) {\r\n        console.log(\"LS:\", { LS })\r\n        let flag = 1 // New Submission Flag\r\n        let status = \"New Submission\"\r\n\r\n        return_results(annotations, flag, status)\r\n      },\r\n      onUpdateAnnotation: function (LS: any, annotations: any) {\r\n        console.log(\"LS update:\", { LS })\r\n        let flag = 2 // Update Submission Flag\r\n        let status = \"Update Submission\"\r\n\r\n        return_results(annotations, flag, status)\r\n      },\r\n      onDeleteAnnotation: function (LS: any, annotations: any) {\r\n        console.log(\"LS Delete:\", { LS })\r\n        let flag = 3 // Update Submission Flag\r\n        let status = \"Delete Submission\"\r\n\r\n        return_results(annotations, flag, status)\r\n      },\r\n      onSkipTask: function (LS: any) {\r\n        console.log(\"LS Skip:\", { LS })\r\n        let flag = 4 // Skip Task Flag\r\n        let status = \"Skip Task\"\r\n        //return nothing\r\n        let annotations = null\r\n        return_results(annotations, flag, status)\r\n      },\r\n    })\r\n    updateFrameHeight()\r\n  })\r\n\r\n  updateFrameHeight()\r\n\r\n  return (\r\n    <div\r\n      style={{ height: \"100%\", width: \"100%\", overflow: \"visible\" }}\r\n      id=\"label-studio\"\r\n    ></div>\r\n  )\r\n}\r\n\r\n/* Function to generate LS_args  */\r\nfunction create_args(\r\n  config: string,\r\n  interfaces: string[],\r\n  user: JSON,\r\n  task: JSON\r\n) {\r\n  const ST_args = {\r\n    config: config,\r\n    interfaces: interfaces,\r\n    user: user,\r\n    task: task,\r\n  }\r\n  console.log(\"UseMemo\", ST_args)\r\n  return ST_args\r\n}\r\n\r\nexport default withStreamlitConnection(LabelStudioEditor)\r\n","/* \r\nCopyright (C) 2021 Selangor Human Resource Development Centre\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License. \r\n\r\nCopyright (C) 2021 Selangor Human Resource Development Centre\r\nSPDX-License-Identifier: Apache-2.0\r\n========================================================================================\r\n*/\r\n\r\nimport React from \"react\"\r\nimport ReactDOM from \"react-dom\"\r\nimport LabelStudioEditor from \"./LabelStudioEditor\"\r\nimport \"./ls.css\"\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <link\r\n      href=\"https://unpkg.com/label-studio@1.0.1/build/static/css/main.css\"\r\n      rel=\"stylesheet\"\r\n    />\r\n    <div id=\"label-studio\">\r\n      <LabelStudioEditor />\r\n    </div>\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n)\r\n"],"sourceRoot":""}